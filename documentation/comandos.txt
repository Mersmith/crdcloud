PS C:\xampp\htdocs>composer create-project laravel/laravel crdcloud
PS C:\xampp\htdocs>cd crdcloud
PS C:\xampp\htdocs>code .

php artisan serve
composer require laravel/jetstream
php artisan jetstream:install livewire
npm install
npm run dev

->Configurar el .env con la base de datos mysql = puntodeventadb.
->Crear la base de datos en phpmyadmin.

php artisan migrate

php artisan make:model Administrador -msf

php artisan make:seeder UserAdministradorSeeder

php artisan make:model Sede -msf

php artisan make:seeder UserEncargadoSeeder

php artisan make:model Especialidad -msf

php artisan make:model Encargado -msf

php artisan make:model Odontologo -msf

php artisan make:model OdontologoSede -msf

php artisan make:model Paciente -msf

php artisan make:model PacienteSede -msf

php artisan make:model OdontologoPaciente -msf

php artisan make:model Clinica -msf

php artisan make:model ClinicaPaciente -msf

php artisan make:model Departamento -msf

php artisan make:model Provincia -msf

php artisan make:model Distrito -msf

php artisan make:model Direccion -msf

php artisan make:model Servicio -msf

php artisan migrate

php artisan migrate:fresh --seed

php artisan make:seeder UserSeeder

->En Actions/Fortify/CreateNewUser.php comentar los campos name

->Instalar paquetes
composer install
npm install

php artisan key:generate

git clone https://github.com/Mersmith/crd.git

/*Controlador de Inicio*/
php artisan make:controller Web/InicioController

php artisan make:model Venta -msf

php artisan make:model VentaDetalle -msf

php artisan make:model Imagen -msf

php artisan make:model Informe -msf

php artisan make:model Canjeo -msf

php artisan make:model CanjeoDetalle -msf

php artisan make:model ImagenCanjeo -msf

php artisan make:model InformeCanjeo -msf

php artisan make:model ImagenPerfil -msf

->Controlador Venta
php artisan make:controller Administrador/VentaController

->Controlador Canjeo
php artisan make:controller Administrador/CanjeoController

php artisan vendor:publish --tag=jetstream-views

php artisan storage:link

//Muestra las direcciones del odontologo
SELECT o.DNI AS odontologo_id, o.nombre, o.departamento AS departamento_id, o.provincia AS provincia_id, o.distrito AS distrito_id, o.direccion, d.departamento AS departamento_nombre, p.provincia AS provincia_nombre, di.distrito AS distrito_nombre, o.fecha_registro AS created_at
FROM odontologo o
JOIN ubdepartamento d ON o.departamento = d.idDepa
JOIN ubprovincia p ON o.provincia = p.idProv
JOIN ubdistrito di ON o.distrito = di.idDist;//359

//Muestra las direcciones del paciente
SELECT o.Id_documento AS paciente_id, o.nombre, o.Departamento AS departamento_id, o.provincia AS provincia_id, o.distrito AS distrito_id, o.direccion, d.departamento AS departamento_nombre, p.provincia AS provincia_nombre, di.distrito AS distrito_nombre, o.fecha_registro AS created_at
FROM paciente o
JOIN ubdepartamento d ON o.Departamento = d.idDepa
JOIN ubprovincia p ON o.provincia = p.idProv
JOIN ubdistrito di ON o.distrito = di.idDist;

SELECT *
FROM odontologo
WHERE departamento IS NULL OR departamento = '';//52

SELECT *
FROM odontologo
WHERE provincia IS NULL OR provincia = '';//66

UPDATE odon
INNER JOIN pacientes ON odon.paciente_id = pacientes.id
SET odon.user_id = pacientes.user_id
WHERE odon.user_id IS NULL;

php artisan make:livewire Encargado/Menu/MenuPrincipal

php artisan make:middleware VerificarRol
php artisan make:policy UserPolicy --model=User

//Verificar las ventas_detalles con odontologos que no existen.
SELECT v.id, v.total, v.estado, v.created_at
FROM ventas v
LEFT JOIN odontologos o ON v.odontologo_id = o.id
WHERE o.id IS NULL;

//Verificar las ventas_detalles con pacientes que no existen.
SELECT v.id, v.total, v.estado, v.created_at
FROM ventas v
LEFT JOIN pacientes o ON v.odontologo_id = o.id
WHERE o.id IS NULL;

//Verificar las venta_detalles con servicios que no existen.
SELECT v.id, v.cantidad, v.precio, v.created_at
FROM venta_detalles2 v
LEFT JOIN servicios o ON v.servicio_id = o.id
WHERE o.id IS NULL;

//Insertar servicios
INSERT INTO `servicios` (`id`, `nombre`, `precio_venta`, `descripcion`, `puntos_ganar`, `puntos_canjeo`, `created_at`, `updated_at`) VALUES ('93', 'ORTO 2 VIRTUAL + SET DE INTRA+FOTOS EXTRA+2 ANALISIS', '200.00', NULL, '10.00', '0.00', NULL, NULL);

//Relacionar odontologos con sus pacientes
SELECT DISTINCT odontologos.id as odontologo_id, pacientes.id as paciente_id
FROM odontologos
JOIN ventas ON odontologos.id = ventas.odontologo_id
JOIN pacientes ON ventas.paciente_id = pacientes.id;

//Relacionar odontologos con sus pacientes
SELECT DISTINCT odontologo.DNI as odontologo_id, paciente.Id_documento as paciente_id
FROM odontologo
JOIN detalle_venta ON odontologo.DNI = detalle_venta.Id_doctor
JOIN paciente ON detalle_venta.Id_paciente = paciente.Id_documento;

//Buscar registros repetidos en la tabla paciente_sede
SELECT paciente_id, sede_id, COUNT(*) as count
FROM paciente_sede
GROUP BY paciente_id, sede_id
HAVING COUNT(*) > 1;

//Verificar las odontologos que no existen con odontologo_sede
SELECT *
FROM odontologo_sede2 v
LEFT JOIN odontologos o ON v.odontologo_id = o.id
WHERE o.id IS NULL;

//usuarios
//Administrador
master@crd.com / master
123456789
//Encargado
miraflores@centroradiologico.com.pe / crdmiraflores
123456789
//Odontologo
TECHICERRO@GMAIL.COM / AURA
DAURA

DAVID / odontologiavacio324edit@gmail.com
11885 / 123456789

DRPLAZA
MOLIDENT

//Paciente
MARIA872SC@GMAIL.COM / 110008
27966191

//Crear un temporal y dar permisos
mkdir -p storage/app/temp
chmod -R 755 storage/app/temp

//Actualizar la tabla odontologos con otra tabla para llenar el campo puntos_bienvenida
UPDATE odontologos o
JOIN puntos p ON o.id = p.id
SET o.puntos_bienvenida = p.puntos_bienvenida;

//Actualizar los odontologos con puntos null
UPDATE odontologos
SET puntos = 0
WHERE puntos IS NULL;

php artisan make:controller Odontologo/DescargarProgramaController

php artisan make:notification CanjeoRealizadoNotification

php artisan notifications:table

php artisan make:controller Web/RedirigirVentaController
